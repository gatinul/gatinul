$(function(){var c=Backbone.Model.extend({validate:function(g){for(var f in g){if(g[f]==""){return f+"不能为空"}if(f=="Score"&&isNaN(g.Score)){return"分数必须是数字"}}}});var e=Backbone.Collection.extend({model:"Student"});var b=new e();var d=Backbone.View.extend({tagName:"li",className:"li_c",template:_.template($("#item-template").html()),events:{"dblclick span":"editing","blur input,select":"blur","click span a":"dele"},editing:function(f){$(f.currentTarget).removeClass("show").addClass("editing").find("input,select").focus()},blur:function(g){var h=$(g.currentTarget);var f={};f[h.attr("name")]=$(curele).val();this.model.set(f,{validate:true});$(g.currentTarget).parent().parent().removeClass("editing").addClass("show")},dele:function(){this.model.destroy()},initialize:function(){this.model.on("change",this.render,this);this.model.on("destroy",this.remove,this)},render:function(){$(this.el).html(this.template(this.model.toJSON()));this.setValue();return this},remove:function(){$(this.el).remove()},setValue:function(){var f=this.model;$(this.el).find("input,select").each(function(){var g=$(this);g.val(f.get(g.attr("name")))})}});var a=Backbone.View.extend({el:$("#stuManager"),events:{"click #btnAdd":"newstu"},initialize:function(){b.bind("add",this.addData,this);$("#StuID").val(b.length+1)},newstu:function(h){var g=new c();var f={};$("#Name,#Sex,#Score").each(function(){f[$(this).attr("name")]=$(this).val()});g.bind("invalid",function(j,i){$("#pStatus").show().html(i)});if(g.set(f,{validate:true})){b.add(g);$("#pStatus").hide()}},addData:function(f){f.set({StuID:f.get("StuID")||b.length});var g=new d({model:f});$("#ulMessage").append(g.render().el);$("#Name,#Score").each(function(){$(this).val("")});$("#StuID").val(b.length+1)}});var a=new a()});