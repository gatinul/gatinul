$(function(){var e=Backbone.Model.extend({defaults:function(){return{title:"empty todo...",order:f.nextOrder(),done:false}},initialize:function(){if(!this.get("title")){this.set({title:this.defaults().title})}},toggle:function(){this.save({done:!this.get("done")})}});var d=Backbone.Collection.extend({model:e,localStorage:new Backbone.LocalStorage("todos-backbone"),done:function(){return this.filter(function(g){return g.get("done")})},remaining:function(){return this.without.apply(this,this.done())},nextOrder:function(){if(!this.length){return 1}return this.last().get("order")+1},comparator:function(g){return g.get("order")}});var f=new d;var a=Backbone.View.extend({tagName:"li",template:_.template($("#item-template").html()),events:{"click .toggle":"toggleDone","dblclick .view":"edit","click a.destroy":"clear","keypress .edit":"updateOnEnter","blur .edit":"close"},initialize:function(){this.listenTo(this.model,"change",this.render);this.listenTo(this.model,"destroy",this.remove)},render:function(){this.$el.html(this.template(this.model.toJSON()));this.$el.toggleClass("done",this.model.get("done"));this.input=this.$(".edit");return this},toggleDone:function(){this.model.toggle()},edit:function(){this.$el.addClass("editing");this.input.focus()},close:function(){var g=this.input.val();if(!g){this.clear()}else{this.model.save({title:g});this.$el.removeClass("editing")}},updateOnEnter:function(g){if(g.keyCode==13){this.close()}},clear:function(){this.model.destroy()}});var c=Backbone.View.extend({el:$("#todoapp"),statsTemplate:_.template($("#stats-template").html()),events:{"keypress #new-todo":"createOnEnter","click #clear-completed":"clearCompleted","click #toggle-all":"toggleAllComplete"},initialize:function(){this.input=this.$("#new-todo");this.allCheckbox=this.$("#toggle-all")[0];this.listenTo(f,"add",this.addOne);this.listenTo(f,"reset",this.addAll);this.listenTo(f,"all",this.render);this.footer=this.$("footer");this.main=$("#main");f.fetch()},render:function(){var g=f.done().length;var h=f.remaining().length;if(f.length){this.main.show();this.footer.show();this.footer.html(this.statsTemplate({done:g,remaining:h}))}else{this.main.hide();this.footer.hide()}this.allCheckbox.checked=!h},addOne:function(g){var h=new a({model:g});this.$("#todo-list").append(h.render().el)},addAll:function(){f.each(this.addOne,this)},createOnEnter:function(g){if(g.keyCode!=13){return}if(!this.input.val()){return}f.create({title:this.input.val()});this.input.val("")},clearCompleted:function(){_.invoke(f.done(),"destroy");return false},toggleAllComplete:function(){var g=this.allCheckbox.checked;f.each(function(h){h.save({done:g})})}});var b=new c});