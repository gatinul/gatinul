(function(e,d){if(typeof define==="function"&&define.amd){define(["underscore","jquery","exports"],function(b,a,c){e.Backbone=d(e,c,b,a)})}else{if(typeof exports!=="undefined"){var f=require("underscore");d(e,exports,f)}else{e.Backbone=d(e,{},e._,(e.jQuery||e.Zepto||e.ender||e.$))}}}(this,function(U,an,Q,ai){var Y=U.Backbone;var ag=[];var W=ag.slice;an.VERSION="1.1.2";an.$=ai;an.noConflict=function(){U.Backbone=Y;return this};an.emulateHTTP=false;an.emulateJSON=false;var aa=an.Events={on:function(d,a,b){if(!M(this,"on",d,[a,b])||!a){return this}this._events||(this._events={});var c=this._events[d]||(this._events[d]=[]);c.push({callback:a,context:b,ctx:b||this});return this},once:function(c,e,b){if(!M(this,"once",c,[e,b])||!e){return this}var d=this;var a=Q.once(function(){d.off(c,a);e.apply(this,arguments)});a._callback=e;return this.on(c,a,b)},off:function(j,b,i){if(!this._events||!M(this,"off",j,[b,i])){return this}if(!j&&!b&&!i){this._events=void 0;return this}var c=j?[j]:Q.keys(this._events);for(var d=0,h=c.length;d<h;d++){j=c[d];var a=this._events[j];if(!a){continue}if(!b&&!i){delete this._events[j];continue}var f=[];for(var e=0,g=a.length;e<g;e++){var k=a[e];if(b&&b!==k.callback&&b!==k.callback._callback||i&&i!==k.context){f.push(k)}}if(f.length){this._events[j]=f}else{delete this._events[j]}}return this},trigger:function(b){if(!this._events){return this}var c=W.call(arguments,1);if(!M(this,"trigger",b,c)){return this}var a=this._events[b];var d=this._events.all;if(a){am(a,c)}if(d){am(d,arguments)}return this},listenTo:function(b,d,e){var c=this._listeningTo||(this._listeningTo={});var a=b._listenId||(b._listenId=Q.uniqueId("l"));c[a]=b;if(!e&&typeof d==="object"){e=this}b.on(d,e,this);return this},listenToOnce:function(f,d,e){if(typeof d==="object"){for(var h in d){this.listenToOnce(f,h,d[h])}return this}if(ap.test(d)){var g=d.split(ap);for(var c=0,a=g.length;c<a;c++){this.listenToOnce(f,g[c],e)}return this}if(!e){return this}var b=Q.once(function(){this.stopListening(f,d,b);e.apply(this,arguments)});b._callback=e;return this.listenTo(f,d,b)},stopListening:function(a,c,e){var b=this._listeningTo;if(!b){return this}var d=!c&&!e;if(!e&&typeof c==="object"){e=this}if(a){(b={})[a._listenId]=a}for(var f in b){a=b[f];a.off(c,e,this);if(d||Q.isEmpty(a._events)){delete this._listeningTo[f]}}return this}};var ap=/\s+/;var M=function(e,g,d,a){if(!d){return true}if(typeof d==="object"){for(var b in d){e[g].apply(e,[b,d[b]].concat(a))}return false}if(ap.test(d)){var f=d.split(ap);for(var c=0,h=f.length;c<h;c++){e[g].apply(e,[f[c]].concat(a))}return false}return true};var am=function(g,a){var f,h=-1,b=g.length,c=a[0],d=a[1],e=a[2];switch(a.length){case 0:while(++h<b){(f=g[h]).callback.call(f.ctx)}return;case 1:while(++h<b){(f=g[h]).callback.call(f.ctx,c)}return;case 2:while(++h<b){(f=g[h]).callback.call(f.ctx,c,d)}return;case 3:while(++h<b){(f=g[h]).callback.call(f.ctx,c,d,e)}return;default:while(++h<b){(f=g[h]).callback.apply(f.ctx,a)}return}};aa.bind=aa.on;aa.unbind=aa.off;Q.extend(an,aa);var ad=an.Model=function(c,a){var b=c||{};a||(a={});this.cid=Q.uniqueId("c");this.attributes={};if(a.collection){this.collection=a.collection}if(a.parse){b=this.parse(b,a)||{}}b=Q.defaults({},b,Q.result(this,"defaults"));this.set(b,a);this.changed={};this.initialize.apply(this,arguments)};Q.extend(ad.prototype,aa,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(a){return Q.clone(this.attributes)},sync:function(){return an.sync.apply(this,arguments)},get:function(a){return this.attributes[a]},escape:function(a){return Q.escape(this.get(a))},has:function(a){return this.get(a)!=null},matches:function(a){return Q.matches(a)(this.attributes)},set:function(e,l,a){var g,d,c,f,h,b,k,i;if(e==null){return this}if(typeof e==="object"){d=e;a=l}else{(d={})[e]=l}a||(a={});if(!this._validate(d,a)){return false}c=a.unset;h=a.silent;f=[];b=this._changing;this._changing=true;if(!b){this._previousAttributes=Q.clone(this.attributes);this.changed={}}i=this.attributes,k=this._previousAttributes;if(this.idAttribute in d){this.id=d[this.idAttribute]}for(g in d){l=d[g];if(!Q.isEqual(i[g],l)){f.push(g)}if(!Q.isEqual(k[g],l)){this.changed[g]=l}else{delete this.changed[g]}c?delete i[g]:i[g]=l}if(!h){if(f.length){this._pending=a}for(var j=0,m=f.length;j<m;j++){this.trigger("change:"+f[j],this,i[f[j]],a)}}if(b){return this}if(!h){while(this._pending){a=this._pending;this._pending=false;this.trigger("change",this,a)}}this._pending=false;this._changing=false;return this},unset:function(b,a){return this.set(b,void 0,Q.extend({},a,{unset:true}))},clear:function(b){var c={};for(var a in this.attributes){c[a]=void 0}return this.set(c,Q.extend({},b,{unset:true}))},hasChanged:function(a){if(a==null){return !Q.isEmpty(this.changed)}return Q.has(this.changed,a)},changedAttributes:function(b){if(!b){return this.hasChanged()?Q.clone(this.changed):false}var e,a=false;var c=this._changing?this._previousAttributes:this.attributes;for(var d in b){if(Q.isEqual(c[d],(e=b[d]))){continue}(a||(a={}))[d]=e}return a},previous:function(a){if(a==null||!this._previousAttributes){return null}return this._previousAttributes[a]},previousAttributes:function(){return Q.clone(this._previousAttributes)},fetch:function(b){b=b?Q.clone(b):{};if(b.parse===void 0){b.parse=true}var c=this;var a=b.success;b.success=function(d){if(!c.set(c.parse(d,b),b)){return false}if(a){a(c,d,b)}c.trigger("sync",c,d,b)};al(this,b);return this.sync("read",this,b)},save:function(e,h,a){var d,i,b,g=this.attributes;if(e==null||typeof e==="object"){d=e;a=h}else{(d={})[e]=h}a=Q.extend({validate:true},a);if(d&&!a.wait){if(!this.set(d,a)){return false}}else{if(!this._validate(d,a)){return false}}if(d&&a.wait){this.attributes=Q.extend({},g,d)}if(a.parse===void 0){a.parse=true}var f=this;var c=a.success;a.success=function(j){f.attributes=g;var k=f.parse(j,a);if(a.wait){k=Q.extend(d||{},k)}if(Q.isObject(k)&&!f.set(k,a)){return false}if(c){c(f,j,a)}f.trigger("sync",f,j,a)};al(this,a);i=this.isNew()?"create":(a.patch?"patch":"update");if(i==="patch"&&!a.attrs){a.attrs=d}b=this.sync(i,this,a);if(d&&a.wait){this.attributes=g}return b},destroy:function(c){c=c?Q.clone(c):{};var d=this;var e=c.success;var b=function(){d.stopListening();d.trigger("destroy",d,d.collection,c)};c.success=function(f){if(c.wait||d.isNew()){b()}if(e){e(d,f,c)}if(!d.isNew()){d.trigger("sync",d,f,c)}};if(this.isNew()){c.success();return false}al(this,c);var a=this.sync("delete",this,c);if(!c.wait){b()}return a},url:function(){var a=Q.result(this,"urlRoot")||Q.result(this.collection,"url")||L();if(this.isNew()){return a}return a.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(a,b){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return !this.has(this.idAttribute)},isValid:function(a){return this._validate({},Q.extend(a||{},{validate:true}))},_validate:function(a,b){if(!b.validate||!this.validate){return true}a=Q.extend({},this.attributes,a);var c=this.validationError=this.validate(a,b)||null;if(!c){return true}this.trigger("invalid",this,c,Q.extend(b,{validationError:c}));return false}});var X=["keys","values","pairs","invert","pick","omit","chain","isEmpty"];Q.each(X,function(a){if(!Q[a]){return}ad.prototype[a]=function(){var b=W.call(arguments);b.unshift(this.attributes);return Q[a].apply(Q,b)}});var O=an.Collection=function(a,b){b||(b={});if(b.model){this.model=b.model}if(b.comparator!==void 0){this.comparator=b.comparator}this._reset();this.initialize.apply(this,arguments);if(a){this.reset(a,Q.extend({silent:true},b))}};var J={add:true,remove:true,merge:true};var ac={add:true,remove:false};Q.extend(O.prototype,aa,{model:ad,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},sync:function(){return an.sync.apply(this,arguments)},add:function(a,b){return this.set(a,Q.extend({merge:false},b,ac))},remove:function(e,b){var h=!Q.isArray(e);e=h?[e]:Q.clone(e);b||(b={});for(var a=0,g=e.length;a<g;a++){var c=e[a]=this.get(e[a]);if(!c){continue}var f=this.modelId(c.attributes);if(f!=null){delete this._byId[f]}delete this._byId[c.cid];var d=this.indexOf(c);this.models.splice(d,1);this.length--;if(!b.silent){b.index=d;c.trigger("remove",c,this,b)}this._removeReference(c,b)}return h?e[0]:e},set:function(u,p){p=Q.defaults({},p,J);if(p.parse){u=this.parse(u,p)}var l=!Q.isArray(u);u=l?(u?[u]:[]):u.slice();var g,o,e,h,v;var j=p.at;if(j!=null){j=+j}if(j<0){j+=this.length+1}var r=this.comparator&&(j==null)&&p.sort!==false;var w=Q.isString(this.comparator)?this.comparator:null;var t=[],d=[],f={};var i=p.add,n=p.merge,s=p.remove;var b=!r&&i&&s?[]:false;var c=false;for(var a=0,q=u.length;a<q;a++){e=u[a];if(h=this.get(e)){if(s){f[h.cid]=true}if(n&&e!==h){e=this._isModel(e)?e.attributes:e;if(p.parse){e=h.parse(e,p)}h.set(e,p);if(r&&!v&&h.hasChanged(w)){v=true}}u[a]=h}else{if(i){o=u[a]=this._prepareModel(e,p);if(!o){continue}t.push(o);this._addReference(o,p)}}o=h||o;if(!o){continue}g=this.modelId(o.attributes);if(b&&(o.isNew()||!f[g])){b.push(o);c=c||!this.models[a]||o.cid!==this.models[a].cid}f[g]=true}if(s){for(var a=0,q=this.length;a<q;a++){if(!f[(o=this.models[a]).cid]){d.push(o)}}if(d.length){this.remove(d,p)}}if(t.length||c){if(r){v=true}this.length+=t.length;if(j!=null){for(var a=0,q=t.length;a<q;a++){this.models.splice(j+a,0,t[a])}}else{if(b){this.models.length=0}var k=b||t;for(var a=0,q=k.length;a<q;a++){this.models.push(k[a])}}}if(v){this.sort({silent:true})}if(!p.silent){var m=j!=null?Q.clone(p):p;for(var a=0,q=t.length;a<q;a++){if(j!=null){m.index=j+a}(o=t[a]).trigger("add",o,this,m)}if(v||c){this.trigger("sort",this,p)}}return l?u[0]:u},reset:function(a,d){d=d?Q.clone(d):{};for(var c=0,b=this.models.length;c<b;c++){this._removeReference(this.models[c],d)}d.previousModels=this.models;this._reset();a=this.add(a,Q.extend({silent:true},d));if(!d.silent){this.trigger("reset",this,d)}return a},push:function(a,b){return this.add(a,Q.extend({at:this.length},b))},pop:function(a){var b=this.at(this.length-1);this.remove(b,a);return b},unshift:function(a,b){return this.add(a,Q.extend({at:0},b))},shift:function(a){var b=this.at(0);this.remove(b,a);return b},slice:function(){return W.apply(this.models,arguments)},get:function(b){if(b==null){return void 0}var a=this.modelId(this._isModel(b)?b.attributes:b);return this._byId[b]||this._byId[a]||this._byId[b.cid]},at:function(a){if(a<0){a+=this.length}return this.models[a]},where:function(c,a){var b=Q.matches(c);return this[a?"find":"filter"](function(d){return b(d.attributes)})},findWhere:function(a){return this.where(a,true)},sort:function(a){if(!this.comparator){throw new Error("Cannot sort a set without a comparator")}a||(a={});if(Q.isString(this.comparator)||this.comparator.length===1){this.models=this.sortBy(this.comparator,this)}else{this.models.sort(Q.bind(this.comparator,this))}if(!a.silent){this.trigger("sort",this,a)}return this},pluck:function(a){return Q.invoke(this.models,"get",a)},fetch:function(c){c=c?Q.clone(c):{};if(c.parse===void 0){c.parse=true}var a=c.success;var b=this;c.success=function(d){var e=c.reset?"reset":"set";b[e](d,c);if(a){a(b,d,c)}b.trigger("sync",b,d,c)};al(this,c);return this.sync("read",this,c)},create:function(c,d){d=d?Q.clone(d):{};if(!(c=this._prepareModel(c,d))){return false}if(!d.wait){this.add(c,d)}var a=this;var b=d.success;d.success=function(f,e){if(d.wait){a.add(f,d)}if(b){b(f,e,d)}};c.save(null,d);return c},parse:function(a,b){return a},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(a){return a[this.model.prototype.idAttribute||"id"]},_reset:function(){this.length=0;this.models=[];this._byId={}},_prepareModel:function(a,b){if(this._isModel(a)){if(!a.collection){a.collection=this}return a}b=b?Q.clone(b):{};b.collection=this;var c=new this.model(a,b);if(!c.validationError){return c}this.trigger("invalid",this,c.validationError,b);return false},_isModel:function(a){return a instanceof ad},_addReference:function(b,c){this._byId[b.cid]=b;var a=this.modelId(b.attributes);if(a!=null){this._byId[a]=b}b.on("all",this._onModelEvent,this)},_removeReference:function(a,b){if(this===a.collection){delete a.collection}a.off("all",this._onModelEvent,this)},_onModelEvent:function(b,c,f,d){if((b==="add"||b==="remove")&&f!==this){return}if(b==="destroy"){this.remove(c,d)}if(b==="change"){var a=this.modelId(c.previousAttributes());var e=this.modelId(c.attributes);if(a!==e){if(a!=null){delete this._byId[a]}if(e!=null){this._byId[e]=c}}}this.trigger.apply(this,arguments)}});var V=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample","partition"];Q.each(V,function(a){if(!Q[a]){return}O.prototype[a]=function(){var b=W.call(arguments);b.unshift(this.models);return Q[a].apply(Q,b)}});var ah=["groupBy","countBy","sortBy","indexBy"];Q.each(ah,function(a){if(!Q[a]){return}O.prototype[a]=function(b,d){var c=Q.isFunction(b)?b:function(e){return e.get(b)};return Q[a](this.models,c,d)}});var N=an.View=function(a){this.cid=Q.uniqueId("view");a||(a={});Q.extend(this,Q.pick(a,K));this._ensureElement();this.initialize.apply(this,arguments)};var aj=/^(\S+)\s*(.*)$/;var K=["model","collection","el","id","attributes","className","tagName","events"];Q.extend(N.prototype,aa,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){this._removeElement();this.stopListening();return this},_removeElement:function(){this.$el.remove()},setElement:function(a){this.undelegateEvents();this._setElement(a);this.delegateEvents();return this},_setElement:function(a){this.$el=a instanceof an.$?a:an.$(a);this.el=this.$el[0]},delegateEvents:function(b){if(!(b||(b=Q.result(this,"events")))){return this}this.undelegateEvents();for(var c in b){var a=b[c];if(!Q.isFunction(a)){a=this[b[c]]}if(!a){continue}var d=c.match(aj);this.delegate(d[1],d[2],Q.bind(a,this))}return this},delegate:function(b,c,a){this.$el.on(b+".delegateEvents"+this.cid,c,a)},undelegateEvents:function(){if(this.$el){this.$el.off(".delegateEvents"+this.cid)}return this},undelegate:function(b,c,a){this.$el.off(b+".delegateEvents"+this.cid,c,a)},_createElement:function(a){return document.createElement(a)},_ensureElement:function(){if(!this.el){var a=Q.extend({},Q.result(this,"attributes"));if(this.id){a.id=Q.result(this,"id")}if(this.className){a["class"]=Q.result(this,"className")}this.setElement(this._createElement(Q.result(this,"tagName")));this._setAttributes(a)}else{this.setElement(Q.result(this,"el"))}},_setAttributes:function(a){this.$el.attr(a)}});an.sync=function(e,b,c){var h=S[e];Q.defaults(c||(c={}),{emulateHTTP:an.emulateHTTP,emulateJSON:an.emulateJSON});var f={type:h,dataType:"json"};if(!c.url){f.url=Q.result(b,"url")||L()}if(c.data==null&&b&&(e==="create"||e==="update"||e==="patch")){f.contentType="application/json";f.data=JSON.stringify(c.attrs||b.toJSON(c))}if(c.emulateJSON){f.contentType="application/x-www-form-urlencoded";f.data=f.data?{model:f.data}:{}}if(c.emulateHTTP&&(h==="PUT"||h==="DELETE"||h==="PATCH")){f.type="POST";if(c.emulateJSON){f.data._method=h}var a=c.beforeSend;c.beforeSend=function(i){i.setRequestHeader("X-HTTP-Method-Override",h);if(a){return a.apply(this,arguments)}}}if(f.type!=="GET"&&!c.emulateJSON){f.processData=false}var d=c.error;c.error=function(j,i,k){c.textStatus=i;c.errorThrown=k;if(d){d.apply(this,arguments)}};var g=c.xhr=an.ajax(Q.extend(f,c));b.trigger("request",b,g,c);return g};var S={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};an.ajax=function(){return an.$.ajax.apply(an.$,arguments)};var R=an.Router=function(a){a||(a={});if(a.routes){this.routes=a.routes}this._bindRoutes();this.initialize.apply(this,arguments)};var ae=/\((.*?)\)/g;var af=/(\(\?)?:\w+/g;var T=/\*\w+/g;var ak=/[\-{}\[\]+?.,\\\^$|#\s]/g;Q.extend(R.prototype,aa,{initialize:function(){},route:function(c,b,a){if(!Q.isRegExp(c)){c=this._routeToRegExp(c)}if(Q.isFunction(b)){a=b;b=""}if(!a){a=this[b]}var d=this;an.history.route(c,function(e){var f=d._extractParameters(c,e);if(d.execute(a,f,b)!==false){d.trigger.apply(d,["route:"+b].concat(f));d.trigger("route",b,f);an.history.trigger("route",d,b,f)}});return this},execute:function(a,b,c){if(a){a.apply(this,b)}},navigate:function(a,b){an.history.navigate(a,b);return this},_bindRoutes:function(){if(!this.routes){return}this.routes=Q.result(this,"routes");var a,b=Q.keys(this.routes);while((a=b.pop())!=null){this.route(a,this.routes[a])}},_routeToRegExp:function(a){a=a.replace(ak,"\\$&").replace(ae,"(?:$1)?").replace(af,function(b,c){return c?b:"([^/?]+)"}).replace(T,"([^?]*?)");return new RegExp("^"+a+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(c,b){var a=c.exec(b).slice(1);return Q.map(a,function(e,d){if(d===a.length-1){return e||null}return e?decodeURIComponent(e):null})}});var ao=an.History=function(){this.handlers=[];Q.bindAll(this,"checkUrl");if(typeof window!=="undefined"){this.location=window.location;this.history=window.history}};var ab=/^[#\/]|\s+$/g;var Z=/^\/+|\/+$/g;var P=/#.*$/;ao.started=false;Q.extend(ao.prototype,aa,{interval:50,atRoot:function(){var a=this.location.pathname.replace(/[^\/]$/,"$&/");return a===this.root&&!this.getSearch()},getSearch:function(){var a=this.location.href.replace(/#.*/,"").match(/\?.+/);return a?a[0]:""},getHash:function(a){var b=(a||this).location.href.match(/#(.*)$/);return b?b[1]:""},getPath:function(){var a=decodeURI(this.location.pathname+this.getSearch());var b=this.root.slice(0,-1);if(!a.indexOf(b)){a=a.slice(b.length)}return a.charAt(0)==="/"?a.slice(1):a},getFragment:function(a){if(a==null){if(this._hasPushState||!this._wantsHashChange){a=this.getPath()}else{a=this.getHash()}}return a.replace(ab,"")},start:function(b){if(ao.started){throw new Error("Backbone.history has already been started")}ao.started=true;this.options=Q.extend({root:"/"},this.options,b);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==false;this._hasHashChange="onhashchange" in window;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);this.fragment=this.getFragment();this.root=("/"+this.root+"/").replace(Z,"/");if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var c=this.root.slice(0,-1)||"/";this.location.replace(c+"#"+this.getPath());return true}else{if(this._hasPushState&&this.atRoot()){this.navigate(this.getHash(),{replace:true})}}}if(!this._hasHashChange&&this._wantsHashChange&&(!this._wantsPushState||!this._hasPushState)){var a=document.createElement("iframe");a.src="javascript:0";a.style.display="none";a.tabIndex=-1;var d=document.body;this.iframe=d.insertBefore(a,d.firstChild).contentWindow;this.iframe.document.open().close();this.iframe.location.hash="#"+this.fragment}var e=window.addEventListener||function(g,f){return attachEvent("on"+g,f)};if(this._hasPushState){e("popstate",this.checkUrl,false)}else{if(this._wantsHashChange&&this._hasHashChange&&!this.iframe){e("hashchange",this.checkUrl,false)}else{if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval)}}}if(!this.options.silent){return this.loadUrl()}},stop:function(){var a=window.removeEventListener||function(c,b){return detachEvent("on"+c,b)};if(this._hasPushState){a("popstate",this.checkUrl,false)}else{if(this._wantsHashChange&&this._hasHashChange&&!this.iframe){a("hashchange",this.checkUrl,false)}}if(this.iframe){document.body.removeChild(this.iframe.frameElement);this.iframe=null}if(this._checkUrlInterval){clearInterval(this._checkUrlInterval)}ao.started=false},route:function(b,a){this.handlers.unshift({route:b,callback:a})},checkUrl:function(a){var b=this.getFragment();if(b===this.fragment&&this.iframe){b=this.getHash(this.iframe)}if(b===this.fragment){return false}if(this.iframe){this.navigate(b)}this.loadUrl()},loadUrl:function(a){a=this.fragment=this.getFragment(a);return Q.any(this.handlers,function(b){if(b.route.test(a)){b.callback(a);return true}})},navigate:function(a,b){if(!ao.started){return false}if(!b||b===true){b={trigger:!!b}}a=this.getFragment(a||"");var d=this.root;if(a===""||a.charAt(0)==="?"){d=d.slice(0,-1)||"/"}var c=d+a;a=decodeURI(a.replace(P,""));if(this.fragment===a){return}this.fragment=a;if(this._hasPushState){this.history[b.replace?"replaceState":"pushState"]({},document.title,c)}else{if(this._wantsHashChange){this._updateHash(this.location,a,b.replace);if(this.iframe&&(a!==this.getHash(this.iframe))){if(!b.replace){this.iframe.document.open().close()}this._updateHash(this.iframe.location,a,b.replace)}}else{return this.location.assign(c)}}if(b.trigger){return this.loadUrl(a)}},_updateHash:function(d,b,a){if(a){var c=d.href.replace(/(javascript:|#).*$/,"");d.replace(c+"#"+b)}else{d.hash="#"+b}}});an.history=new ao;var I=function(d,b){var c=this;var e;if(d&&Q.has(d,"constructor")){e=d.constructor}else{e=function(){return c.apply(this,arguments)}}Q.extend(e,c,b);var a=function(){this.constructor=e};a.prototype=c.prototype;e.prototype=new a;if(d){Q.extend(e.prototype,d)}e.__super__=c.prototype;return e};ad.extend=O.extend=R.extend=N.extend=ao.extend=I;var L=function(){throw new Error('A "url" property or function must be specified')};var al=function(a,b){var c=b.error;b.error=function(d){if(c){c(a,d,b)}a.trigger("error",a,d,b)}};return an}));